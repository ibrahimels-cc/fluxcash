<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flux Cash - Ø§Ø±Ø¨Ø­ Ø§Ù„Ù…Ø§Ù„</title>
    
    <!-- Ø®Ø·ÙˆØ· ÙˆØ£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary: #00ff88;
            --primary-glow: rgba(0, 255, 136, 0.4);
            --secondary: #7000ff;
            --bg-dark: #050505;
            --card-bg: rgba(255, 255, 255, 0.05);
            --glass: blur(15px);
            --text-main: #ffffff;
            --text-muted: #aaaaaa;
            --danger: #ff3333;
            --font: 'Tajawal', sans-serif;
            --gradient: linear-gradient(135deg, var(--secondary), var(--primary));
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { font-family: var(--font); background: var(--bg-dark); color: var(--text-main); overflow-x: hidden; min-height: 100vh; padding-bottom: 80px; }

        /* Helpers */
        .hidden { display: none !important; }
        .flex-center { display: flex; align-items: center; justify-content: center; }
        .glass-card { background: var(--card-bg); backdrop-filter: var(--glass); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 20px; box-shadow: 0 4px 30px rgba(0,0,0,0.2); margin-bottom: 15px; position: relative; overflow: hidden; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; font-size: 1rem; cursor: pointer; transition: 0.3s; font-family: var(--font); color: white; }
        .btn-primary { background: var(--gradient); box-shadow: 0 5px 20px var(--primary-glow); }
        .btn-primary:active { transform: scale(0.98); }
        .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); }
        .input-box { width: 100%; padding: 15px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; font-family: var(--font); margin-bottom: 10px; }
        .input-box:focus { border-color: var(--primary); }

        /* Animations */
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(0, 255, 136, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0); } }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* 1. Splash Screen */
        #splash { position: fixed; inset: 0; background: var(--bg-dark); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .logo-text { font-size: 3rem; font-weight: 900; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .loader { width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.1); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-top: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* 2. Onboarding */
        #onboarding { position: fixed; inset: 0; background: var(--bg-dark); z-index: 9000; display: flex; flex-direction: column; }
        .slide { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; text-align: center; display: none; }
        .slide.active { display: flex; animation: fadeIn 0.5s; }
        .slide-img { width: 200px; height: 200px; object-fit: contain; margin-bottom: 30px; animation: float 3s ease-in-out infinite; }
        .slide h2 { margin-bottom: 10px; color: var(--primary); }
        .slide p { color: var(--text-muted); line-height: 1.6; }
        .dots { display: flex; gap: 8px; margin-bottom: 20px; justify-content: center; }
        .dot { width: 10px; height: 10px; background: rgba(255,255,255,0.2); border-radius: 50%; }
        .dot.active { background: var(--primary); width: 25px; border-radius: 10px; }

        /* 3. Auth */
        #auth { padding: 30px; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; }

        /* 4. Main App */
        /* Header */
        .app-header { padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .user-info { display: flex; align-items: center; gap: 10px; }
        .avatar { width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(45deg, #333, #111); display: flex; align-items: center; justify-content: center; border: 2px solid var(--primary); font-size: 1.2rem; }
        
        /* Balance Card */
        .balance-card { text-align: center; margin: 0 20px; padding: 25px; background: radial-gradient(circle at top right, rgba(0,255,136,0.1), transparent), var(--card-bg); border: 1px solid var(--primary-glow); }
        .balance-usd { font-size: 3rem; font-weight: 900; letter-spacing: -1px; }
        .points-tag { background: rgba(0,0,0,0.4); padding: 6px 15px; border-radius: 20px; font-size: 0.9rem; color: var(--primary); display: inline-flex; align-items: center; gap: 5px; margin-top: 5px; }
        
        /* Ticker */
        .ticker-wrap { width: 100%; overflow: hidden; background: rgba(255,255,255,0.02); padding: 8px 0; margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.05); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .ticker { display: inline-block; white-space: nowrap; animation: ticker 20s linear infinite; }
        .ticker-item { display: inline-block; padding: 0 20px; color: #aaa; font-size: 0.8rem; }
        .ticker-item span { color: var(--success-color, #00ff88); font-weight: bold; }
        @keyframes ticker { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        /* Earn Grid */
        .earn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; }
        .earn-card { text-align: center; padding: 20px; transition: 0.3s; cursor: pointer; }
        .earn-card:active { transform: scale(0.95); background: rgba(0,255,136,0.1); }
        .earn-icon { font-size: 2.5rem; margin-bottom: 10px; display: block; }

        /* Support Chat */
        .chat-area { height: 60vh; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 80%; padding: 10px 15px; border-radius: 15px; font-size: 0.9rem; line-height: 1.4; }
        .msg-me { align-self: flex-end; background: var(--gradient); color: white; border-bottom-left-radius: 0; }
        .msg-admin { align-self: flex-start; background: #333; color: white; border-bottom-right-radius: 0; }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: rgba(5, 5, 5, 0.9); backdrop-filter: blur(20px); border-top: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-around; padding: 15px 0; z-index: 1000; padding-bottom: max(15px, env(safe-area-inset-bottom)); }
        .nav-item { color: var(--text-muted); font-size: 0.75rem; display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; transition: 0.3s; }
        .nav-item i { font-size: 1.5rem; transition: 0.3s; }
        .nav-item.active { color: var(--primary); }
        .nav-item.active i { transform: translateY(-3px); text-shadow: 0 0 10px var(--primary); }

        /* Toast */
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px); background: #111; border: 1px solid var(--primary); padding: 10px 20px; border-radius: 30px; z-index: 10000; transition: 0.3s; display: flex; align-items: center; gap: 10px; opacity: 0; }
        #toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    </style>
</head>
<body>

    <!-- Notification -->
    <div id="toast"><i class="ri-checkbox-circle-fill" style="color:var(--primary)"></i> <span id="toast-msg">ØªÙ… Ø¨Ù†Ø¬Ø§Ø­</span></div>

    <!-- 1ï¸âƒ£ Splash Screen -->
    <div id="splash">
        <div class="logo-text">FLUX</div>
        <p style="letter-spacing: 5px; color: var(--text-muted); font-size: 0.8rem;">C A S H</p>
        <div class="loader"></div>
        <p style="margin-top: 20px; font-size: 0.8rem; color: #555;">v1.0.0 by Ibrahim</p>
    </div>

    <!-- 2ï¸âƒ£ Onboarding Screens -->
    <div id="onboarding" class="hidden">
        <!-- Slide 1 -->
        <div class="slide active" id="slide1">
            <i class="ri-gamepad-line slide-img" style="font-size: 8rem; color: #ff0055;"></i>
            <h2>Ø§Ù„Ø¹Ø¨ ÙˆØ§Ø±Ø¨Ø­</h2>
            <p>Ø­ÙˆÙ„ ÙˆÙ‚Øª ÙØ±Ø§ØºÙƒ Ø¥Ù„Ù‰ Ø£Ù…ÙˆØ§Ù„ Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Ø®Ù„Ø§Ù„ Ù„Ø¹Ø¨ Ø£Ù„Ø¹Ø§Ø¨ Ù…Ù…ØªØ¹Ø© ÙˆØ¨Ø³ÙŠØ·Ø©.</p>
        </div>
        <!-- Slide 2 -->
        <div class="slide" id="slide2">
            <i class="ri-task-line slide-img" style="font-size: 8rem; color: #0088ff;"></i>
            <h2>Ø£ÙƒÙ…Ù„ Ø§Ù„Ù…Ù‡Ø§Ù…</h2>
            <p>Ù…Ù‡Ø§Ù… ÙŠÙˆÙ…ÙŠØ© Ø¨Ø³ÙŠØ·Ø© ØªÙ…Ù†Ø­Ùƒ Ù†Ù‚Ø§Ø·Ø§Ù‹ ÙÙˆØ±ÙŠØ© ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ù„Ø¯ÙˆÙ„Ø§Ø±Ø§Øª.</p>
        </div>
        <!-- Slide 3 -->
        <div class="slide" id="slide3">
            <i class="ri-group-line slide-img" style="font-size: 8rem; color: #ffaa00;"></i>
            <h2>Ø§Ø¯Ø¹Ù Ø£ØµØ¯Ù‚Ø§Ø¡Ùƒ</h2>
            <p>Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ 15% Ù…Ù† Ø£Ø±Ø¨Ø§Ø­ ÙƒÙ„ ØµØ¯ÙŠÙ‚ ØªÙ‚ÙˆÙ… Ø¨Ø¯Ø¹ÙˆØªÙ‡ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©.</p>
        </div>

        <!-- Controls -->
        <div style="position: absolute; bottom: 40px; width: 100%; padding: 0 30px;">
            <div class="dots">
                <div class="dot active"></div><div class="dot"></div><div class="dot"></div>
            </div>
            <button onclick="nextSlide()" class="btn btn-primary" id="onboard-btn">Ø§Ù„ØªØ§Ù„ÙŠ</button>
            <p onclick="skipOnboarding()" style="text-align: center; margin-top: 15px; color: #777; font-size: 0.9rem; cursor: pointer;">ØªØ®Ø·ÙŠ</p>
        </div>
    </div>

    <!-- 3ï¸âƒ£ Authentication -->
    <div id="auth" class="hidden">
        <div class="glass-card fade-in">
            <h2 style="text-align: center; margin-bottom: 20px;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹</h2>
            
            <div id="register-fields" class="hidden">
                <input type="text" id="reg-name" class="input-box" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                <input type="text" id="reg-ref" class="input-box" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø¹ÙˆØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            </div>
            
            <input type="email" id="email" class="input-box" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="pass" class="input-box" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            
            <button onclick="handleAuth()" class="btn btn-primary" id="auth-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            
            <p style="text-align: center; margin-top: 20px; font-size: 0.9rem; color: var(--text-muted);">
                <span id="auth-switch-text">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ</span>
                <span onclick="toggleAuthMode()" style="color: var(--primary); font-weight: bold; cursor: pointer;">Ø§Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨</span>
            </p>
        </div>
    </div>

    <!-- 4ï¸âƒ£ Main Application -->
    <div id="app" class="hidden">
        
        <!-- ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <section id="home-page" class="fade-in">
            <div class="app-header">
                <div class="user-info">
                    <div class="avatar">ğŸ‘¤</div>
                    <div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ</div>
                        <div style="font-weight: bold;" id="display-name">User</div>
                    </div>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 15px; font-size: 0.8rem;">
                    <i class="ri-shield-star-line" style="color: #ffd700;"></i> Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1
                </div>
            </div>

            <div class="balance-card glass-card">
                <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 5px;">Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                <div class="balance-usd">$<span id="usd-balance">0.00</span></div>
                <div class="points-tag">
                    <i class="ri-coin-fill"></i> <span id="points-balance">0</span> Ù†Ù‚Ø·Ø©
                </div>
                <div style="margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button onclick="convertPoints()" class="btn btn-outline" style="padding: 8px; font-size: 0.8rem;">ğŸ’± ØªØ­ÙˆÙŠÙ„</button>
                    <button onclick="nav('withdraw')" class="btn btn-primary" style="padding: 8px; font-size: 0.8rem;">ğŸ’¸ Ø³Ø­Ø¨</button>
                </div>
            </div>

            <!-- Ticker -->
            <div class="ticker-wrap">
                <div class="ticker">
                    <div class="ticker-item">Ø£Ø­Ù…Ø¯ Ø³Ø­Ø¨ <span>$5.00</span> Ø¹Ø¨Ø± PayPal</div>
                    <div class="ticker-item">Ø³Ø§Ø±Ø© Ø±Ø¨Ø­Øª <span>500 Ù†Ù‚Ø·Ø©</span> Ù…Ù† Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</div>
                    <div class="ticker-item">Ù…Ø­Ù…Ø¯ Ø³Ø­Ø¨ <span>$10.00</span> Ø¹Ø¨Ø± Vodafone</div>
                    <div class="ticker-item">Ø¹Ù…Ø± Ø£ÙƒÙ…Ù„ <span>Ù…Ù‡Ù…Ø© ÙŠÙˆÙ…ÙŠØ©</span></div>
                    <div class="ticker-item">Ø¹Ù„ÙŠ Ø³Ø­Ø¨ <span>$2.00</span> Ø¹Ø¨Ø± USDT</div>
                </div>
            </div>

            <div class="earn-grid">
                <div class="glass-card earn-card" onclick="earn('game')">
                    <i class="ri-gamepad-fill earn-icon" style="color: #ff0055;"></i>
                    <h4>Ø£Ù„Ø¹Ø§Ø¨</h4>
                    <small style="color: #888;">Ø§Ù„Ø¹Ø¨ ÙˆØ§Ø±Ø¨Ø­</small>
                </div>
                <div class="glass-card earn-card" onclick="earn('task')">
                    <i class="ri-todo-fill earn-icon" style="color: #0088ff;"></i>
                    <h4>Ù…Ù‡Ø§Ù…</h4>
                    <small style="color: #888;">Ø³Ù‡Ù„Ø© ÙˆØ³Ø±ÙŠØ¹Ø©</small>
                </div>
                <div class="glass-card earn-card" onclick="earn('ad')">
                    <i class="ri-movie-fill earn-icon" style="color: #ffaa00;"></i>
                    <h4>ÙÙŠØ¯ÙŠÙˆ</h4>
                    <small style="color: #888;">Ø´Ø§Ù‡Ø¯ Ø¥Ø¹Ù„Ø§Ù†</small>
                </div>
                <div class="glass-card earn-card" onclick="earn('daily')">
                    <i class="ri-gift-2-fill earn-icon" style="color: #00ff88;"></i>
                    <h4>ÙŠÙˆÙ…ÙŠ</h4>
                    <small style="color: #888;">Ù‡Ø¯ÙŠØ© Ø¯Ø®ÙˆÙ„</small>
                </div>
            </div>
        </section>

        <!-- ØµÙØ­Ø© Ø§Ù„Ø³Ø­Ø¨ -->
        <section id="withdraw-page" class="hidden fade-in" style="padding: 20px;">
            <h2 style="margin-bottom: 20px;">Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h2>
            <div class="glass-card">
                <p style="margin-bottom: 10px;">Ø§Ø®ØªØ± ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø³Ø­Ø¨</p>
                <select id="withdraw-method" class="input-box" style="background: #222;">
                    <option value="" disabled selected>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</option>
                </select>
                <input type="number" id="withdraw-amount" class="input-box" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº ($)">
                <input type="text" id="withdraw-address" class="input-box" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© / Ø§Ù„Ø§ÙŠÙ…ÙŠÙ„">
                <button onclick="submitWithdraw()" class="btn btn-primary">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
            </div>
            
            <h4 style="margin-top: 30px; margin-bottom: 10px;">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h4>
            <div id="withdraw-history">
                <!-- History Items -->
            </div>
        </section>

        <!-- ØµÙØ­Ø© Ø§Ù„Ø¯Ø¹Ù… -->
        <section id="support-page" class="hidden fade-in" style="padding: 20px;">
            <h2 style="margin-bottom: 20px;">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</h2>
            <div class="glass-card" style="height: 75vh; display: flex; flex-direction: column; padding: 0;">
                <div style="padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2);">
                    <p style="font-size: 0.8rem;">ØªØ­Ø¯Ø« Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©</p>
                </div>
                <div id="chat-messages" class="chat-area">
                    <div style="text-align: center; color: #555; margin-top: 50px;">
                        Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©.<br>Ø³ÙŠØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.
                    </div>
                </div>
                <div style="padding: 10px; display: flex; gap: 10px; background: rgba(0,0,0,0.4);">
                    <input type="text" id="chat-input" class="input-box" style="margin: 0;" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...">
                    <button onclick="sendMessage()" class="btn btn-primary" style="width: auto;"><i class="ri-send-plane-fill"></i></button>
                </div>
            </div>
        </section>

        <!-- ØµÙØ­Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ -->
        <section id="profile-page" class="hidden fade-in" style="padding: 20px; text-align: center;">
            <div style="width: 100px; height: 100px; border-radius: 50%; background: var(--gradient); margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 3rem; box-shadow: 0 0 20px rgba(0,255,136,0.3);">ğŸ‘¤</div>
            <h2 id="profile-name">User Name</h2>
            <p id="profile-email" style="color: var(--text-muted); margin-bottom: 20px;">email@example.com</p>

            <div class="glass-card" style="text-align: right;">
                <div style="margin-bottom: 10px; display: flex; justify-content: space-between;">
                    <span>ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø¹ÙˆØ©</span>
                    <span id="ref-code" style="color: var(--primary); font-weight: bold; cursor: pointer;" onclick="copyRef()">LOADING</span>
                </div>
                <div style="margin-bottom: 10px; display: flex; justify-content: space-between;">
                    <span>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø¯Ø¹ÙˆÙŠÙ†</span>
                    <span>0</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Ø§Ù„Ø­Ø§Ù„Ø©</span>
                    <span id="profile-status" style="color: var(--success);">Ù†Ø´Ø·</span>
                </div>
            </div>

            <div class="glass-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <span>Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…</span>
                    <i class="ri-moon-fill"></i>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>Ø§Ù„Ù„ØºØ© / Language</span>
                    <span>AR</span>
                </div>
            </div>

            <button onclick="logout()" class="btn btn-outline" style="border-color: var(--danger); color: var(--danger); margin-bottom: 50px;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
            <p style="color: #555; font-size: 0.7rem;">Flux Cash v1.0.0<br>Developed by Ibrahim</p>
        </section>

    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav hidden" id="navbar">
        <div class="nav-item active" onclick="nav('home')"><i class="ri-home-5-line"></i><span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></div>
        <div class="nav-item" onclick="nav('withdraw')"><i class="ri-wallet-3-line"></i><span>Ø³Ø­Ø¨</span></div>
        <div class="nav-item" onclick="nav('support')"><i class="ri-customer-service-2-line"></i><span>Ø§Ù„Ø¯Ø¹Ù…</span></div>
        <div class="nav-item" onclick="nav('profile')"><i class="ri-user-3-line"></i><span>Ø­Ø³Ø§Ø¨ÙŠ</span></div>
    </nav>

    <script>
        // --- 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase ---
        // Ù†ÙØ³ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ù…Ù„Ù Ø§Ù„Ø£Ø¯Ù…Ù† Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø±Ø¨Ø·
        const firebaseConfig = {
            apiKey: "AIzaSyDYcs_MasNecH2TgY1hPnYVb5Npp2mVSeE",
            authDomain: "fluxcash-2261d.firebaseapp.com",
            databaseURL: "https://fluxcash-2261d-default-rtdb.firebaseio.com",
            projectId: "fluxcash-2261d",
            storageBucket: "fluxcash-2261d.firebasestorage.app",
            messagingSenderId: "1019180136606",
            appId: "1:1019180136606:web:d6a8909dc84050aed7e38f",
            measurementId: "G-80Y3FGZT1Y"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // --- 2. Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© ---
        let currentUser = null;
        let userData = {};
        let isLoginMode = true;
        let currentSlide = 1;
        
        // --- 3. Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ù„Ù€ Splash ---
        window.onload = () => {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Onboarding
            const seenOnboarding = localStorage.getItem('seenOnboarding');
            
            setTimeout(() => {
                document.getElementById('splash').classList.add('hidden');
                
                auth.onAuthStateChanged(user => {
                    if (user) {
                        currentUser = user;
                        initApp();
                    } else {
                        if (!seenOnboarding) {
                            document.getElementById('onboarding').classList.remove('hidden');
                        } else {
                            document.getElementById('auth').classList.remove('hidden');
                        }
                    }
                });
            }, 2500);
        };

        // --- 4. Ù…Ù†Ø·Ù‚ Onboarding ---
        function nextSlide() {
            document.getElementById(`slide${currentSlide}`).classList.remove('active');
            document.querySelectorAll('.dot')[currentSlide-1].classList.remove('active');
            
            currentSlide++;
            
            if (currentSlide > 3) {
                skipOnboarding();
                return;
            }
            
            document.getElementById(`slide${currentSlide}`).classList.add('active');
            document.querySelectorAll('.dot')[currentSlide-1].classList.add('active');
            
            if(currentSlide === 3) document.getElementById('onboard-btn').textContent = "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†";
        }

        function skipOnboarding() {
            localStorage.setItem('seenOnboarding', 'true');
            document.getElementById('onboarding').classList.add('hidden');
            document.getElementById('auth').classList.remove('hidden');
        }

        // --- 5. Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (Auth) ---
        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            document.getElementById('register-fields').classList.toggle('hidden', isLoginMode);
            document.getElementById('auth-btn').textContent = isLoginMode ? "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„" : "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨";
            document.getElementById('auth-switch-text').textContent = isLoginMode ? "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ" : "Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ";
        }

        function handleAuth() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('pass').value;
            const btn = document.getElementById('auth-btn');

            if(!email || !pass) return showToast("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©");

            btn.textContent = "Ø¬Ø§Ø± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";

            if (isLoginMode) {
                auth.signInWithEmailAndPassword(email, pass).catch(e => {
                    showToast(e.message);
                    btn.textContent = "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„";
                });
            } else {
                const name = document.getElementById('reg-name').value;
                if(!name) return showToast("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…");
                
                auth.createUserWithEmailAndPassword(email, pass).then(cred => {
                    const refCode = Math.random().toString(36).substring(2, 8).toUpperCase();
                    db.ref('users/' + cred.user.uid).set({
                        username: name,
                        email: email,
                        points: 0,
                        balance: 0.00,
                        refCode: refCode,
                        joined: new Date().toISOString()
                    });
                }).catch(e => {
                    showToast(e.message);
                    btn.textContent = "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨";
                });
            }
        }

        function logout() {
            auth.signOut().then(() => location.reload());
        }

        // --- 6. Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ---
        function initApp() {
            document.getElementById('auth').classList.add('hidden');
            document.getElementById('onboarding').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('navbar').classList.remove('hidden');

            // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            db.ref('users/' + currentUser.uid).on('value', snap => {
                userData = snap.val();
                if(!userData) return;

                document.getElementById('display-name').textContent = userData.username;
                document.getElementById('profile-name').textContent = userData.username;
                document.getElementById('profile-email').textContent = userData.email;
                document.getElementById('usd-balance').textContent = userData.balance.toFixed(2);
                document.getElementById('points-balance').textContent = userData.points;
                document.getElementById('ref-code').textContent = userData.refCode;
                
                if(userData.isVerified) {
                    document.getElementById('profile-status').innerHTML = 'Ù…ÙˆØ«Ù‚ <i class="ri-checkbox-circle-fill" style="color:#1da1f2"></i>';
                }
            });

            // ØªØ­Ù…ÙŠÙ„ Ø·Ø±Ù‚ Ø§Ù„Ø³Ø­Ø¨
            loadWithdrawMethods();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            loadMessages();
        }

        // --- 7. Ø§Ù„ØªÙ†Ù‚Ù„ ---
        function nav(page) {
            document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
            document.getElementById(page + '-page').classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        // --- 8. Ø§Ù„ÙƒØ³Ø¨ ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„ ---
        function earn(type) {
            let pts = 0;
            let msg = "";
            
            // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ£Ø®ÙŠØ± Ø§Ù„Ø´Ø¨ÙƒØ©
            document.body.style.cursor = 'wait';
            
            setTimeout(() => {
                if(type === 'game') { pts = 50; msg = "+50 Ù†Ù‚Ø·Ø© (Ù„Ø¹Ø¨Ø©)"; }
                if(type === 'task') { pts = 100; msg = "+100 Ù†Ù‚Ø·Ø© (Ù…Ù‡Ù…Ø©)"; }
                if(type === 'ad') { pts = 20; msg = "+20 Ù†Ù‚Ø·Ø© (ÙÙŠØ¯ÙŠÙˆ)"; }
                if(type === 'daily') { pts = 200; msg = "+200 Ù†Ù‚Ø·Ø© (Ù…ÙƒØ§ÙØ£Ø©)"; }

                db.ref('users/' + currentUser.uid).update({
                    points: (userData.points || 0) + pts
                });
                showToast(msg);
                document.body.style.cursor = 'default';
            }, 1000);
        }

        function convertPoints() {
            // Ø¬Ù„Ø¨ Ø³Ø¹Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© (Ø§Ù„ØªÙŠ ÙˆØ¶Ø¹Ù‡Ø§ Ø§Ù„Ø£Ø¯Ù…Ù†)
            db.ref('settings/rate').once('value', snap => {
                const rate = snap.val() || 1000;
                
                if (userData.points < rate) {
                    showToast(`ØªØ­ØªØ§Ø¬ ${rate} Ù†Ù‚Ø·Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„ØªØ­ÙˆÙŠÙ„`);
                    return;
                }

                const newPoints = userData.points - rate;
                const newBalance = userData.balance + 1;

                db.ref('users/' + currentUser.uid).update({
                    points: newPoints,
                    balance: newBalance
                });
                showToast("ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¥Ù„Ù‰ $1.00");
            });
        }

        // --- 9. Ø§Ù„Ø³Ø­Ø¨ ---
        function loadWithdrawMethods() {
            db.ref('payment_methods').on('value', snap => {
                const select = document.getElementById('withdraw-method');
                select.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± ÙˆØ³ÙŠÙ„Ø©...</option>';
                snap.forEach(c => {
                    const m = c.val();
                    select.innerHTML += `<option value="${m.name}">${m.name} (Min: $${m.min})</option>`;
                });
            });

            // ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø³Ø­Ø¨
            db.ref('withdrawals').orderByChild('userId').equalTo(currentUser.uid).on('value', snap => {
                const list = document.getElementById('withdraw-history');
                list.innerHTML = '';
                snap.forEach(c => {
                    const w = c.val();
                    const statusColor = w.status === 'pending' ? 'orange' : (w.status === 'approved' ? 'var(--success)' : 'red');
                    const statusText = w.status === 'pending' ? 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' : (w.status === 'approved' ? 'Ù…Ù‚Ø¨ÙˆÙ„' : 'Ù…Ø±ÙÙˆØ¶');
                    
                    list.innerHTML += `
                        <div class="glass-card" style="padding:10px; margin-bottom:10px;">
                            <div style="display:flex; justify-content:space-between;">
                                <span>${w.method}</span>
                                <b>$${w.amount}</b>
                            </div>
                            <div style="font-size:0.8rem; color:#aaa; display:flex; justify-content:space-between;">
                                <span>${new Date(w.date).toLocaleDateString()}</span>
                                <span style="color:${statusColor}">${statusText}</span>
                            </div>
                        </div>
                    `;
                });
            });
        }

        function submitWithdraw() {
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const method = document.getElementById('withdraw-method').value;
            const address = document.getElementById('withdraw-address').value;

            if(!amount || !method || !address) return showToast("Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
            if(amount > userData.balance) return showToast("Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙ");

            db.ref('users/' + currentUser.uid).update({ balance: userData.balance - amount });
            db.ref('withdrawals').push({
                userId: currentUser.uid,
                username: userData.username,
                amount: amount,
                method: method,
                address: address,
                status: 'pending',
                date: new Date().toISOString()
            });
            showToast("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­");
            nav('home');
        }

        // --- 10. Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ ---
        let supportTicketId = null;

        function loadMessages() {
            // Ù†Ø¨Ø­Ø« Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØªØ°ÙƒØ±Ø© Ù…ÙØªÙˆØ­Ø©
            db.ref('support_tickets').orderByChild('userId').equalTo(currentUser.uid).on('value', snap => {
                const area = document.getElementById('chat-messages');
                area.innerHTML = '';
                let hasTicket = false;

                snap.forEach(c => {
                    const t = c.val();
                    if(t.status === 'open') {
                        hasTicket = true;
                        supportTicketId = c.key;
                        
                        // ØªØ­Ù…ÙŠÙ„ Ø±Ø³Ø§Ø¦Ù„ Ù‡Ø°Ù‡ Ø§Ù„ØªØ°ÙƒØ±Ø©
                        const msgs = t.messages || {};
                        Object.values(msgs).forEach(m => {
                            const cls = m.sender === 'user' ? 'msg-me' : 'msg-admin';
                            area.innerHTML += `<div class="msg ${cls}">${m.text}</div>`;
                        });
                    }
                });
                
                if(!hasTicket) {
                    area.innerHTML = '<div style="text-align:center; color:#777; margin-top:50px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù†Ø´Ø·Ø©.<br>Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ù„ÙØªØ­ ØªØ°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©.</div>';
                    supportTicketId = null;
                }
                
                area.scrollTop = area.scrollHeight;
            });
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if(!text) return;

            if(!supportTicketId) {
                // Ø¥Ù†Ø´Ø§Ø¡ ØªØ°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
                const newTicket = db.ref('support_tickets').push();
                newTicket.set({
                    userId: currentUser.uid,
                    username: userData.username,
                    subject: 'New Message',
                    status: 'open',
                    lastMsg: text,
                    messages: {}
                }).then(() => {
                    supportTicketId = newTicket.key;
                    pushMsg(text);
                });
            } else {
                pushMsg(text);
            }
            input.value = '';
        }

        function pushMsg(text) {
            db.ref(`support_tickets/${supportTicketId}/messages`).push({
                text: text,
                sender: 'user',
                date: new Date().toISOString()
            });
            db.ref(`support_tickets/${supportTicketId}`).update({ lastMsg: text });
        }

        // --- 11. Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ---
        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        function copyRef() {
            navigator.clipboard.writeText(userData.refCode);
            showToast("ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø¹ÙˆØ©");
        }
    </script>
</body>
</html>